# 进展记录自定义时间功能

## 功能概述

为进展记录编辑页面添加了时间选择器功能，允许用户在创建或编辑进展记录时手动指定记录时间。这个功能主要用于补登记之前漏掉的记录。

## 主要特性

### 1. 时间选择器
- **位置**: 在"进展内容"和"思考总结"之间
- **类型**: `datetime-local` 输入框，支持选择日期和时间
- **可选**: 如果不填写，系统自动使用当前时间

### 2. 使用场景
- **补登记**: 记录昨天或更早时间的进展
- **时间修正**: 编辑现有记录的时间
- **历史整理**: 批量整理历史进展记录

### 3. 用户界面
- **标签**: "记录时间（可选）"
- **提示**: "留空则使用当前时间"
- **说明**: "此功能用于补登记之前漏掉的记录，如'昨天忘记记录的进展'"

## 功能细节

### 创建新记录
1. 用户在进展记录页面填写内容
2. 如果需要指定特定时间，点击时间选择器
3. 选择日期和时间（精确到分钟）
4. 提交后，记录会使用指定的时间而非当前时间

### 编辑现有记录
1. 点击记录的"编辑"按钮
2. 系统自动在时间选择器中预填充当前记录的时间
3. 用户可以修改时间、内容或思考
4. 保存后记录时间会更新为新选择的时间

### 默认行为
- 如果时间选择器为空，创建记录时使用当前时间
- 编辑记录时，预填充原始记录的时间
- 取消编辑时，清除表单中的自定义时间

## 技术实现

### 前端更新
```typescript
interface ProgressRecord {
  id: number
  plan_id: string
  plan_name?: string
  content: string
  thinking: string
  gmt_create: string
  custom_time?: string  // 新增字段
}
```

### API更新

#### POST /api/progress_record
```javascript
{
  "plan_id": "plan_xxx",
  "content": "进展内容",
  "thinking": "思考总结",
  "custom_time": "2025-06-01T14:30"  // 可选，ISO格式
}
```

#### PUT /api/progress_record
```javascript
{
  "id": 123,
  "content": "更新的内容",
  "thinking": "更新的思考",
  "custom_time": "2025-06-01T16:45"  // 可选，更新记录时间
}
```

### 时间处理逻辑
```javascript
// 创建记录
const createData = {
  plan_id: data.plan_id,
  content: data.content || '',
  thinking: data.thinking || ''
}

// 如果提供了自定义时间，使用该时间
if (data.custom_time) {
  createData.gmt_create = new Date(data.custom_time)
}
// 否则Prisma会自动使用当前时间（@default(now())）
```

## 使用方法

### 补登记昨天的记录
1. 进入进展记录页面
2. 选择对应的计划
3. 填写进展内容和思考总结
4. 点击时间选择器，选择昨天的日期和大概时间
5. 点击"添加进展"保存

### 修正记录时间
1. 在记录列表中找到需要修正的记录
2. 点击"编辑"按钮
3. 在时间选择器中修改为正确的时间
4. 点击"更新进展"保存

### 批量整理历史记录
1. 按时间顺序逐一创建记录
2. 每条记录都选择对应的历史时间
3. 系统会按实际时间排序显示

## 界面示例

```
进展内容 *
┌─────────────────────────────────────┐
│ 今天完成了React组件的重构...         │
│                                     │
└─────────────────────────────────────┘

记录时间（可选） 留空则使用当前时间
┌─────────────────────────────────────┐
│ 2025-06-01T14:30                    │ [📅]
└─────────────────────────────────────┘
💡 提示：此功能用于补登记之前漏掉的记录，如"昨天忘记记录的进展"

思考总结
┌─────────────────────────────────────┐
│ 通过重构学习了React Hooks的...      │
│                                     │
└─────────────────────────────────────┘
```

## 注意事项

1. **时间格式**: 使用浏览器的 `datetime-local` 格式，精确到分钟
2. **时区处理**: 时间会根据用户的本地时区进行处理
3. **历史限制**: 可以选择任意历史时间，但建议不要选择未来时间
4. **排序影响**: 修改记录时间会影响记录在列表中的排序位置

## 优势

1. **补漏功能**: 解决忘记及时记录进展的问题
2. **时间准确**: 让进展记录的时间更准确反映实际情况
3. **历史整理**: 便于整理和导入历史进展数据
4. **用户友好**: 界面简洁，操作直观
5. **向后兼容**: 不影响现有记录的功能

这个功能特别适合那些经常忘记及时记录进展，但希望保持准确时间记录的用户！ 